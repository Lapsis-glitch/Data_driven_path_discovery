set num_replicas 32
cutoff 16
pairlistdist 18.0
switching off
exclude scaled1-4
1-4scaling     0.833333
############################################################################
#cr
#cr            (C) Copyright 1995-2009 The Board of Trustees of the
#cr                        University of Illinois
#cr                         All Rights Reserved
#cr
############################################################################

############################################################################
# RCS INFORMATION:
#
#       $RCSfile: QMMM.conf,v $
#       $Author: jribeiro $        $Locker:  $             $State: Exp $
#       $Revision: 1.2 $       $Date: 2017/06/29 20:35:19 $
#
############################################################################
##START HERE###
##Simulation Template##
# Simulation conditions
amber                   yes
coordinates             LIG_dry.pdb
parmfile                LIG_dry.prmtop

#binCoordinates QMMM-Equi.restart.coor
#binVelocities QMMM-Equi.restart.vel
#extendedSystem QMMM-Equi.restart.xsc

# Simulation conditions
temperature 300


# Harmonic constraints

#constraints off
#consref QMMM-Min_restraints.pdb
#conskfile QMMM-Min_restraints.pdb
#constraintScaling 2
#consexp 2
#conskcol B
#extraBonds on
#extraBondsFile constraints.dat

# Output Parameters

binaryoutput no
outputname QMMM.[myReplica]
outputenergies 10
outputtiming 1000
outputpressure 100000
binaryrestart yes
dcdfile QMMM.[myReplica].dcd
dcdfreq 10
XSTFreq 100000
restartfreq 1000
restartname QMMM.[myReplica].restart


# Thermostat Parameters
langevin on
langevintemp 300
langevinHydrogen    on
langevindamping 5

# Barostat Parameters

#usegrouppressure yes
#useflexiblecell no
#useConstantArea no
#langevinpiston off
#langevinpistontarget 1
#langevinpistonperiod 200
#langevinpistondecay 100
#langevinpistontemp 60

# Integrator Parameters

timestep 0.5
firstTimestep 0
fullElectFrequency 1
nonbondedfreq 1
stepspercycle   1

# Force Field Parameters

#paratypecharmm on
#parameters toppar_water_ions_namd.str
#parameters toppar_all36_carb_glycopeptide.str
#parameters par_all36_lipid.prm
#parameters par_all36_na.prm
#parameters par_all36_prot.prm
#parameters par_all36_carb.prm
#parameters par_all36_cgenff.prm
#exclude scaled1-4
#1-4scaling 1.0
rigidbonds all


#Implicit Solvent Parameters

gbis off
#alphaCutoff         14.0
#ionConcentration    0.15

# Truns ON or OFF the QM calculations

qmForces on

#printExclusions on

# Name of a secondary PDB file where the OCCupancy
# or BETA column has the indications for QM or MM atoms.

qmParamPDB inp_QwikMD_qm-input.pdb

# Indicates qhich column has the QM/MM field.

qmColumn beta

# Number of simultaneous QM simulations per node

QMSimsPerNode 1

# Indicates qhich column has the QM-MM bond information.

qmBondColumn occ

# Indicates wether the value in the BondColumn will define the distance
# between the QM atom and the Dummy atom that will replace the MM atom

# qmBondDist      on

# Indicates if the values in the bond column represent either: 
# LEN: the length betwen the QM and dummy atoms.

# QMBondValueType len

# User defined Link Atom element.

#QMLinkElement "18 38 Cl"

# Indicates what will be the treatment given to QM-MM bonds in terms of
# charge distribution and dummy atom creation and placement.

#QMBondScheme CS

# This will scale down the point charges representing the classical system 
# as to replicate the switching procedure that NAMD applies to all charged
# interaction.

QMSwitching on

# This option is used to decide which kind of function will be used to scale
# down point charges sent to QM calculations.

QMSwitchingType Switch

# This will alter the point charges presented to the QM system.

QMPointChargeScheme Round

# Directory where QM calculations will be ran.

qmBaseDir "[pwd]/qmmm_exec/QMMM"

# Indicates to NAMD that ALL forces form NAMD will be ignored and only
# the gradients from the QM software will be applied on the atoms.

qmReplaceAll    OFF

# The QM code will change all QM atom's VdW types to "q"+element for VdW interactions.

QMVdWParams off

# Indicates that no Poitn Charges should be selected and applied in 
# QM systems.

qmElecEmbed On

# Sets a stride for new point charge determination.

QMPCStride      1

# Indicates that one or more files will be provided with a custom selection
# of point charges.

QMCustomPCSelection     off

# The file will have, in the "qmColumn", the same QM ID provided for a single QM group.

QMCustomPCFile  input-CustomPC-1.0.pdb


# With Live Solvent Selection, NAMD will automatically keep track of the 
# solvent molecules for all QM Groups, and will exchange classical solvent
# molecules with QM solvent molecules every "QMLSSFreq" steps.

QMLiveSolventSel off

# This indicate which residue type will be used in LSS.

QMLSSResname      TIP3

# Frequency of LSS.

QMLSSFreq         50

# For LSS, this indicates how solvent molecules are selected.

QMLSSMode       dist


# This will indicate which residues are to be used in the determination of the 
# COM of non-solvent QM atoms.

QMLSSRef        "1 RP1 9"

# The string passed to "qmConfigLine" will be copied and pasted at the very
# begining of the configuration file for the chosen QM software.

#qmConfigLine "!B3LYP 6-31G* Grid4"
#qmConfigLine "!EnGrad TightSCF"

# Multiplicity of the QM region. 

qmMult 1 0

# Indicates the charge of each QM region.

qmCharge 1 0.00


# Indicates which QM software should be used.

qmSoftware custom

# Path to the executable

#qmExecPath "[pwd]/runORCA.py"
qmExecPath "[pwd]/runMACE.py"
#qmExecPath "[pwd]/runXTB.py"

# Charge mode expected from the QM software. 

QMChargeMode mulliken

# Frequency of QM charge output.

QMOutStride     100000

# Frequency of QM ONLY position output.

QMPositionOutStride     100000

#cSMD simulation setup
#qmCSMD on
#qmCSMDFile ./cSMD_params

# ABF SECTION

colvars              on
colvarsConfig        Distance_ref.in

# Number of steps in the QM/MM simulation

# Script
run 5000000

set file [open QMMM.[myReplica].check w+]
set done 1
if {[file exists QMMM.[myReplica].restart.coor] != 1 || [file exists QMMM.[myReplica].restart.vel] != 1 || [file exists QMMM.[myReplica].restart.xsc] != 1 } {
	 set done 0
}
if {$done == 1} {
	puts $file "DONE"
    flush $file
  close $file
} else {
	puts $file "One or more files failed to be written"
   flush $file
  close $file
}
